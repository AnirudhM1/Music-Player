<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/search.css" type="text/css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.2/css/bulma.min.css">
    <script src="https://use.fontawesome.com/releases/v5.12.0/js/all.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Quicksand">
    <script src="https://unpkg.com/scrollreveal"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="/js/autocomplete.js"></script>
    <title>Search</title>
</head>



<body style="font-family: 'Quicksand';">

    <div class=" box" style="margin-bottom: 0;">
        <nav class="nav">
            <center class="nav-center">
                <a class="icon">
                    <i class="fab fa-itunes-note" id="icon"></i>
                </a>
            </center>
        </nav>
    </div>


    <div class="maine">
        <br>
        <br>

        <center>
            <nav class="breadcrumb has-succeeds-separator">
                <ul style="align-items:center;justify-content:center">
                    <li id="link"><a href="/" style="color: black;">Home</a></li>
                    <li id="link"><a href="/users" style="color: black;">Profile</a></li>
                    <li id="link" class="is-active"><a href="/search" style="color: rgb(104, 104, 104);">Search</a>
                    </li>
                </ul>
            </nav>
        </center>


        <br>

        <form action="/search" method="POST" autocomplete="off" class="field">
            <center>
                <div class="autocomplete">
                    <input type="text" id="search" name="search" class="input is-hovered is-medium"
                        placeholder="Search." style="font-family: 'Quicksand';width: 70vw;">
                </div>
                <button class="button is-medium is-hovered" id="submit" style="font-family: 'Quicksand';
                    margin: 1em;
                    background-color: 
                    transparent;border: 1px solid rgb(75, 75, 75);">Submit</button>
            </center>
        </form>


        <div id="header" class="header">
            <div class="title is-3 has-text-left">
                Top Results
            </div>
        </div>

        <div id="notification1" style="display:none">
            has been added to your playlist.
        </div>

        <! Display songs>


            <div class="tile is-ancestor">
                <! Column 1>
                    <div class="tile is-vertical">
                        <% for(let i=0;i<songs.length;i+=2) { %>
                            <div class="tile is-child">
                                <% const song=songs[i] %>
                                    <%- include('partials/songCard', {song}) %>
                            </div>
                            <% } %>
                    </div>
                    <! Column 2>
                        <div class="tile is-vertical">
                            <% for(let i=1;i<songs.length;i+=2) { %>
                                <div class="tile is-child">
                                    <% const song=songs[i] %>
                                        <%- include('partials/songCard', {song}) %>
                                </div>
                                <% } %>
                        </div>
            </div>
    </div>

    <div class="container">
        <div class="add" style="display:none;position: fixed; top: 30%; left:5% ;width:30vw;margin:-4em 0 0 0; ">
            <div class="title is-4 has-text-left">
                To which one?
                <br>
                <br>
                <div class="subtitle">

                    <% playlists.forEach(playlist=> { %>
                        <button class="button is-outlined is-dark" id="login"
                            style="width: fit-content; height: fit-content;font-family: 'Quicksand';cursor: pointer;margin: 0.5em;"
                            onclick="addSongToPlaylist('<%= playlist._id %>')">
                            <%= playlist.title %>
                        </button>
                        <br>
                        <% }) %>
                            <br>
                            <br>

                </div>
            </div>
        </div>
    </div>


    <script>

        async function addSongToPlaylist(playlist_id) {
            // TODO use axios to add song to playlist

            const URL = `users/<%= user_id%>/playlists/${playlist_id}`;
            console.log(selectedSong);
            await axios.post(URL, {
                song_id: selectedSong
            });
            window.location.href = "/search";

            document.querySelector(".maine").style.display = null;
            document.querySelector(".add").style.display = "none"
        }
    </script>
</body>